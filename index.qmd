---
title: "Data Analytic Workflow (Introduction)"
author: "Emmanuel Adewuyi"
format: html
editor: visual
---


By the end of this session, you should be able to:

-   Load and inspect a dataset in R

-   Clean data and handle missing values

-   Create summary tables and visualizations

-   Ask and answer questions with EDA

-   Fit and interpret a simple predictive model

-   Evaluate model performance

-   Export results for reporting

## Load Necessary Packages

```{r}
required_pkgs <- c(
"tidyverse",
"palmerpenguins",
"skimr",
"janitor",
"gtsummary",
"broom",
"yardstick",
"DataExplorer"
)

to_install <- required_pkgs[!required_pkgs %in% installed.packages()[, "Package"]]
if (length(to_install) > 0) install.packages(to_install)

library(tidyverse)
library(palmerpenguins)
library(skimr)
library(janitor)
library(gtsummary)
library(broom)
library(yardstick)

```

## Load Dataset

We will be using the Penguin dataset obtainable from the `palmerpenguin` package

```{r}
data("penguins")
df <- penguins

glimpse(df)

```

### Data Dictionary

-   species: penguin species

-   island: island in Palmer Archipelago

-   bill_length_mm, bill_depth_mm: bill measurements

-   flipper_length_mm: flipper length

-   body_mass_g: body mass

-   sex: male/female

-   year: year of study

## First checks: shape, missingness, duplicates

```{r}
dim(df)
names(df)

df %>% summarise(across(everything(), ~sum(is.na(.))))
df %>% janitor::get_dupes() %>% head()
```

## Cleaning & preparation (Feature engineering)

It involves making the data fit enough for modelling.

Typical tasks:

-   Standardize column names

-   Handle missing values

-   Recode factors / fix inconsistent labels

-   Create derived variables

```{r}
df_clean <- df %>%
janitor::clean_names() %>%
mutate(
species = as.factor(species),
island  = as.factor(island),
sex     = as.factor(sex),
year    = as.factor(year),
body_mass_kg = body_mass_g / 1000
)

glimpse(df_clean)

```

### Handle missing data

Here we’ll drop rows missing key modelling variables (simple approach for teaching). Later you can discuss imputation.

```{r}
df_model <- df_clean %>%
drop_na(species, bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g, sex)

dim(df_model)
```

## EDA

```{r}
df_model %>% DataExplorer::plot_histogram()
```

### Quick overview using `skimr`

```{r}
skim(df_model)

```

**Some Analytic Questions**

1.  Ask analytic questions (examples)

2.  Do species differ in average body mass?

3.  Which predictors best explain body mass?

4.  Does sex matter after controlling for measurements?

### Summary Tables

#### Numerical Summaries

df_model %\>%

summarise(

n = n(),

mean_mass = mean(body_mass_g),

sd_mass = sd(body_mass_g),

min_mass = min(body_mass_g),

max_mass = max(body_mass_g)

)

```{r}
df_model %>%
summarise(
n = n(),
mean_mass = mean(body_mass_g),
sd_mass = sd(body_mass_g),
min_mass = min(body_mass_g),
max_mass = max(body_mass_g)
)

```

#### Group (Categorical) Summaries

```{r}
df_model %>%
group_by(species) %>%
summarise(
n = n(),
mean_mass = mean(body_mass_g),
sd_mass = sd(body_mass_g),
mean_flipper = mean(flipper_length_mm),
.groups = "drop"
) %>%
arrange(desc(mean_mass))
```

### Visuals

Distribution of the Body Mass

```{r}
ggplot(df_model, aes(x = body_mass_g)) +
geom_histogram(bins = 30) +
labs(title = "Distribution of Body Mass", x = "Body mass (g)", y = "Count")+ facet_grid(~species)

```

Body Mass by Species

```{r}
ggplot(df_model, aes(x = species, y = body_mass_g)) +
geom_violin() +
labs(title = "Body Mass by Species", x = "Species", y = "Body mass (g)")

```

Relationships

```{r}
ggplot(df_model, aes(x = flipper_length_mm, y = body_mass_g, color = species)) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = FALSE) +
labs(
title = "Body Mass vs Flipper Length",
x = "Flipper length (mm)",
y = "Body mass (g)"
)

```



# Data Story telling and Visualisation

## 1. What is Storytelling with Data?

**Storytelling** means using data to communicate a message clearly — not just showing charts.

A good data story has:

- **Context** – What problem are we exploring?
- **Characters** – Who is affected? (patients, communities, programs)
- **Conflict** – What challenge exists?
- **Insight** – What patterns do we see?
- **Action** – What should be done?

> *Data storytelling = Data + Visuals + Meaning + Action*

---

## 2. What is Data Visualization?

**Data visualization** is the graphical representation of data to:

- simplify complex information  
- highlight patterns and trends  
- support better decisions  

Examples include bar charts, histograms, boxplots, and scatter plots.

> Visualization is powerful because the human brain understands images faster than tables.

---

## 3. Why Does It Matter (Especially in Health)?

- Helps health workers **see risks and trends**
- Supports **policy decisions**
- Makes research **understandable to non-experts**
- Encourages **evidence-based actions**

---

## 4. Load Packages & Dataset (Health Example)

We’ll use the `birthwt` dataset from the **MASS** package — it explores risk factors for **low birth weight**.

```{r}
library(MASS)
library(dplyr)
library(ggplot2)

data("birthwt")

head(birthwt)

```

## Understand the data

The birthwt data frame has 189 rows and 10 columns. The data were collected at Baystate Medical Center, Springfield, Mass during 1986.

- low: indicator of birth weight less than 2.5 kg.

- age: mother's age in years.

- lwt: mother's weight in pounds at last menstrual period.

- race: mother's race (1 = white, 2 = black, 3 = other).

- smoke: smoking status during pregnancy.

- ptl: number of previous premature labours.

- ht: history of hypertension.

- ui: presence of uterine irritability.

- ftv: number of physician visits during the first trimester.

- bwt: birth weight in grams.

```{r}
birthwt |>
summary()
```

### Wrangle some variable in the dataset

```{r}
birthwt |> 
  mutate(race=factor(race, levels=c(1,2,3), labels=c("White", "Black", "Others")),
         bwt=bwt/1000,
         ui=ifelse(ui==1, "Yes", "No"),
         ht=ifelse(ht==1, "Yes", "No")) -> newdf
```


```{r}
head(newdf)

```



## Start the Story: Our Question

*Does smoking increase the risk of low birth weight?*

```{r}
birthwt <- birthwt |>
mutate(
smoke = factor(smoke, labels = c("Non-smoker", "Smoker")),
low_bw = ifelse(bwt < 2500, "Low Birth Weight", "Normal")
)

```


## Distribution of Birthweight

```{r}
ggplot(birthwt, aes(bwt)) +
geom_histogram(bins=25) +
labs(
title = "Distribution of Birth Weight",
x = "Birth Weight (grams)",
y = "Count"
)

```




### Smoking vs Birthweight

```{r}
ggplot(birthwt, aes(x = smoke, y = bwt)) +
geom_boxplot() +
labs(
title = "Birth Weight by Smoking Status",
x = "Smoking Status",
y = "Birth Weight (grams)"
)

```


Risk of Low Birthweight by smoking


```{r}
birthwt |>
count(smoke, low_bw)
```


```{r}
birthwt |>
count(smoke, low_bw) |>
mutate(p = n / sum(n)) |>
ggplot(aes(smoke, p, fill = low_bw)) +
geom_col(position = "fill") +
labs(
title = "Proportion of Low Birth Weight by Smoking",
x = "Smoking Status",
y = "Proportion"
)

```

### Others

*Does mother's race affect the risk of low birth weight?*

```{r}
newdf2 <- newdf |>
mutate(
smoke = factor(smoke, labels = c("Non-smoker", "Smoker")),
low_bw = ifelse(bwt < 2500, "Low Birth Weight", "Normal")
)

```






### Mother's race vs Birthweight

```{r}
ggplot(newdf, aes(x = race, y = bwt)) +
geom_boxplot() +
labs(
title = "Birth Weight by Mother's race",
x = "Mother's race",
y = "Birth Weight (grams)"
)

```


Risk of Low Birthweight by Race

```{r}
birthwt |>
count(race, low_bw) |>
mutate(p = n / sum(n)) |>
ggplot(aes(race, p, fill = low_bw)) +
geom_col(position = "fill") +
labs(
title = "Proportion of Low Birth Weight by Race",
x = "Mother's race",
y = "Proportion"
)

```
